# 🚀 CDN System - Content Delivery Network

A comprehensive, production-ready Content Delivery Network built with modern technologies and best practices.

## 🏗️ Architecture

### Tech Stack

**Frontend/Load Balancer:**
- **Nginx** - High-performance reverse proxy and load balancer

**Edge Servers:**
- **Go** - High-performance edge servers with Redis caching
- **Redis** - Distributed caching layer

**Origin Server:**
- **Node.js/Express** - Content management and API server
- **PostgreSQL** - Metadata and analytics storage
- **Multer** - File upload handling

**Analytics & Monitoring:**
- **Python/FastAPI** - Analytics processing service
- **InfluxDB** - Time-series data for analytics
- **Prometheus** - Metrics collection
- **Grafana** - Monitoring dashboards

**Infrastructure:**
- **Docker & Docker Compose** - Containerization
- **Kubernetes** - Production orchestration
- **SSL/TLS** - Security

### System Components

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │───▶│    Nginx    │───▶│ Edge Server │
└─────────────┘    │Load Balancer│    │   (Go)      │
                   └─────────────┘    └─────────────┘
                          │                   │
                          ▼                   ▼
                   ┌─────────────┐    ┌─────────────┐
                   │ API Gateway │    │    Redis    │
                   │  (Node.js)  │    │   Cache     │
                   └─────────────┘    └─────────────┘
                          │                   │
                          ▼                   ▼
                   ┌─────────────┐    ┌─────────────┐
                   │Origin Server│    │ PostgreSQL  │
                   │  (Node.js)  │    │  Database   │
                   └─────────────┘    └─────────────┘
                          │                   │
                          ▼                   ▼
                   ┌─────────────┐    ┌─────────────┐
                   │ Analytics   │    │  InfluxDB   │
                   │ (Python)    │    │(Time Series)│
                   └─────────────┘    └─────────────┘
                          │                   │
                          ▼                   ▼
                   ┌─────────────┐    ┌─────────────┐
                   │ Prometheus  │    │   Grafana   │
                   │  Metrics    │    │ Dashboards  │
                   └─────────────┘    └─────────────┘
```

## 🚀 Quick Start

### Prerequisites

- Docker & Docker Compose
- Git
- curl (for testing)
- OpenSSL (for SSL certificates)

### 1. Clone and Setup

```bash
git clone <repository-url>
cd cdn-system

# Make scripts executable
chmod +x scripts/*.sh

# Run setup
./scripts/setup.sh
```

### 2. Deploy

```bash
# Build and start all services
./scripts/deploy.sh
```

### 3. Verify

```bash
# Run comprehensive tests
./scripts/test.sh
```

## 🌐 Service Access

| Service | URL | Credentials |
|---------|-----|-------------|
| **CDN** | http://localhost | - |
| **Grafana** | http://localhost:3001 | admin/admin123 |
| **Prometheus** | http://localhost:9090 | - |
| **InfluxDB** | http://localhost:8086 | admin/admin123 |
| **API Docs** | http://localhost/api/docs | - |

## 🔧 Configuration

### Environment Variables

Create `.env` file (auto-generated by setup script):

```bash
# Database
POSTGRES_DB=cdn_db
POSTGRES_USER=cdn_user
POSTGRES_PASSWORD=cdn_password

# Redis
REDIS_PASSWORD=redis_password

# InfluxDB
INFLUXDB_ADMIN_USER=admin
INFLUXDB_ADMIN_PASSWORD=admin123

# Application
NODE_ENV=production
CDN_DOMAIN=localhost
API_SECRET_KEY=<generated-key>
```

### Custom Configuration

1. **Nginx Configuration**: Edit `nginx/nginx.conf`
2. **Database Schema**: Modify `database/postgresql/init.sql`
3. **Monitoring**: Update `monitoring/prometheus/prometheus.yml`
4. **SSL Certificates**: Replace files in `nginx/ssl/`

## 📊 API Endpoints

### Content Management

```bash
# Upload files
POST /upload
Content-Type: multipart/form-data

# Get content
GET /content/{filename}

# Static content (immutable)
GET /static/{filename}

# List files
GET /files?page=1&limit=20
```

### Analytics

```bash
# Real-time metrics
GET /api/analytics

# Daily report
GET /reports/daily/2024-01-15

# Top content
GET /content/top?limit=10

# Server performance
GET /servers/performance
```

### Cache Management

```bash
# Invalidate cache
DELETE /cache/{pattern}

# Health check
GET /health
```

## 🐳 Docker Commands

### Development

```bash
# Start services
docker-compose up -d

# View logs
docker-compose logs -f [service-name]

# Restart service
docker-compose restart [service-name]

# Scale edge servers
docker-compose up -d --scale edge-server-1=3

# Stop all
docker-compose down
```

### Production Build

```bash
# Build for production
docker-compose -f docker-compose.prod.yml build

# Deploy production
docker-compose -f docker-compose.prod.yml up -d
```

## ☸️ Kubernetes Deployment

### Prerequisites

- Kubernetes cluster (minikube, GKE, EKS, AKS)
- kubectl configured
- Docker images built and pushed to registry

### Deploy to Kubernetes

```bash
# Apply all manifests
kubectl apply -f kubernetes/

# Check status
kubectl get pods -n cdn-system

# Scale edge servers
kubectl scale deployment edge-server --replicas=5 -n cdn-system

# Access via port-forward
kubectl port-forward service/nginx 8080:80 -n cdn-system
```

### Kubernetes Monitoring

```bash
# View logs
kubectl logs -f deployment/edge-server -n cdn-system

# Get metrics
kubectl top pods -n cdn-system

# Access Grafana
kubectl port-forward service/grafana 3001:3000 -n cdn-system
```

## 📈 Monitoring & Analytics

### Key Metrics

- **Cache Hit Rate**: Percentage of requests served from cache
- **Response Time**: Average response time per region
- **Bandwidth Usage**: Total bytes served
- **Error Rate**: HTTP 4xx/5xx responses
- **Geographic Distribution**: Requests by country/region

### Grafana Dashboards

1. **CDN Overview**: High-level metrics and status
2. **Edge Server Performance**: Per-server metrics
3. **Content Analytics**: Most popular content
4. **Geographic Analytics**: Regional performance
5. **System Health**: Infrastructure monitoring

### Alerts

Prometheus alerts configured for:
- High error rates (>5%)
- Low cache hit rates (<80%)
- High response times (>2s)
- Service downtime
- Disk space usage (>85%)

## 🔒 Security

### Features

- **SSL/TLS Encryption**: HTTPS by default
- **Rate Limiting**: Per-IP request limits
- **CORS Protection**: Configurable origins
- **Input Validation**: File type and size limits
- **Security Headers**: XSS, CSRF protection
- **Authentication**: API key-based access

### SSL Configuration

```bash
# Generate production certificates
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout nginx/ssl/cdn.key \
    -out nginx/ssl/cdn.crt \
    -subj "/C=US/ST=State/L=City/O=Org/CN=yourdomain.com"

# Or use Let's Encrypt with certbot
certbot certonly --webroot -w /var/www/html -d yourdomain.com
```

## 🧪 Testing

### Unit Tests

```bash
# Node.js services
cd origin-server && npm test

# Go services
cd edge-server && go test ./...

# Python services
cd analytics-service && python -m pytest
```

### Integration Tests

```bash
# Full system test
./scripts/test.sh

# Load testing with Apache Bench
ab -n 1000 -c 10 http://localhost/static/test-file.jpg

# Custom load test with curl
for i in {1..100}; do
  curl -s http://localhost/content/test-file.jpg > /dev/null &
done
wait
```

## 🔧 Troubleshooting

### Common Issues

1. **Port Already in Use**
   ```bash
   # Find and kill process
   lsof -i :80
   kill -9 <PID>
   ```

2. **Database Connection Failed**
   ```bash
   # Check PostgreSQL logs
   docker-compose logs postgres
   
   # Reset database
   docker-compose down -v
   docker-compose up -d postgres
   ```

3. **Redis Connection Issues**
   ```bash
   # Test Redis connectivity
   docker-compose exec redis-cluster redis-cli ping
   
   # Check Redis logs
   docker-compose logs redis-cluster
   ```

4. **Edge Server Cache Issues**
   ```bash
   # Clear Redis cache
   docker-compose exec redis-cluster redis-cli FLUSHALL
   
   # Restart edge servers
   docker-compose restart edge-server-1 edge-server-2
   ```

### Log Locations

```bash
# Application logs
docker-compose logs [service-name]

# Nginx access logs
docker-compose exec nginx tail -f /var/log/nginx/access.log

# System logs
journalctl -u docker
```

## 📚 Development Guide

### Adding New Features

1. **New API Endpoint**
   - Add route to `origin-server/src/routes/`
   - Update database schema if needed
   - Add tests in `tests/`

2. **New Metrics**
   - Add metric to Prometheus config
   - Create Grafana dashboard
   - Update alert rules

3. **New Edge Location**
   - Scale edge servers: `docker-compose up -d --scale edge-server-1=N`
   - Update load balancer configuration
   - Monitor geographic distribution

### Code Structure

```
cdn-system/
├── nginx/              # Load balancer configuration
├── origin-server/      # Node.js content management
├── edge-server/        # Go edge servers
├── api-gateway/        # API routing and auth
├── analytics-service/  # Python analytics
├── database/          # Database schemas and config
├── monitoring/        # Prometheus and Grafana
├── kubernetes/        # K8s deployment manifests
├── scripts/          # Deployment and utility scripts
├── tests/            # Test suites
└── docs/             # Additional documentation
```

## 🚀 Production Deployment

### Preparation

1. **Domain Setup**
   ```bash
   # Update nginx.conf with your domain
   server_name yourdomain.com;
   ```

2. **SSL Certificates**
   ```bash
   # Use Let's Encrypt or commercial certificates
   certbot --nginx -d yourdomain.com
   ```

3. **Environment Variables**
   ```bash
   # Update production values
   NODE_ENV=production
   CDN_DOMAIN=yourdomain.com
   ```

### Cloud Deployment

#### AWS
- Use ECS/EKS for container orchestration
- CloudFront as global CDN layer
- RDS for PostgreSQL
- ElastiCache for Redis
- Route 53 for DNS

#### Google Cloud
- Use GKE for Kubernetes
- Cloud CDN for global distribution
- Cloud SQL for PostgreSQL
- Memorystore for Redis
- Cloud DNS for routing

#### Azure
- Use AKS for containers
- Azure CDN for global reach
- Azure Database for PostgreSQL
- Azure Cache for Redis
- Azure DNS for domain management

## 🤝 Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature/amazing-feature`
3. Commit changes: `git commit -m 'Add amazing feature'`
4. Push to branch: `git push origin feature/amazing-feature`
5. Open Pull Request

### Development Workflow

```bash
# Setup development environment
./scripts/setup.sh

# Start development services
docker-compose up -d

# Make changes and test
./scripts/test.sh

# View logs
docker-compose logs -f [service-name]
```

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🆘 Support

- **Documentation**: Check `/docs` folder for detailed guides
- **Issues**: Report bugs via GitHub Issues
- **Community**: Join our discussions
- **Professional Support**: Contact for enterprise support

## 🎯 Roadmap

### Current Version (v1.0)
- ✅ Basic CDN functionality
- ✅ Multi-region edge servers
- ✅ Real-time analytics
- ✅ Docker deployment
- ✅ Kubernetes support

### Future Versions
- 🔄 HTTP/3 support
- 🔄 Image optimization service
- 🔄 Video streaming capabilities
- 🔄 Advanced security features
- 🔄 Machine learning-based caching

---

**Built with ❤️ for high-performance content delivery**